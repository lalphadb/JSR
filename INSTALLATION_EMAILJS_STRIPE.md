# üìßüí≥ GUIDE D'INSTALLATION - EmailJS & Stripe

## üéØ CE QUI A √âT√â FAIT

### ‚úÖ Code install√©:
1. **EmailJS** - Pour l'envoi d'emails du formulaire de contact
2. **Stripe** - Pour les paiements en ligne
3. **Formulaire de contact fonctionnel** - Avec validation et envoi r√©el
4. **Composant de paiement** - Bouton pr√©-configur√©

---

## üìß √âTAPE 1: CONFIGURATION EMAILJS (GRATUIT)

### 1.1 Cr√©er un compte EmailJS

1. Allez sur **https://www.emailjs.com/**
2. Cliquez sur "Sign Up" (c'est gratuit jusqu'√† 200 emails/mois)
3. Confirmez votre email

### 1.2 Configurer le service d'email

1. Dans le dashboard EmailJS, allez dans **"Email Services"**
2. Cliquez sur **"Add New Service"**
3. S√©lectionnez **"Gmail"** (recommand√© car vous utilisez jsrdeneigement@gmail.com)
4. Connectez votre compte Gmail (jsrdeneigement@gmail.com)
5. Notez le **SERVICE ID** (ex: service_abc123)

### 1.3 Cr√©er un template d'email

1. Allez dans **"Email Templates"**
2. Cliquez sur **"Create New Template"**
3. Utilisez ce template:

```
Nouveau message de contact - JSR D√©neigement
=============================================

De: {{from_name}}
Email: {{from_email}}
T√©l√©phone: {{from_phone}}

Message:
{{message}}

---
Envoy√© depuis le formulaire de contact de jsr.4lb.ca
```

4. Dans les param√®tres du template:
   - **To Email**: jsrdeneigement@gmail.com
   - **From Name**: {{from_name}}
   - **Reply To**: {{from_email}}
   - **Subject**: Nouveau message de {{from_name}} - JSR D√©neigement

5. Cliquez sur "Save" et notez le **TEMPLATE ID** (ex: template_xyz789)

### 1.4 Obtenir la cl√© publique

1. Allez dans **"Account"** > **"General"**
2. Trouvez la section **"Public Key"**
3. Notez votre **PUBLIC KEY** (ex: aBc123XyZ)

### 1.5 Configurer les variables d'environnement

Modifiez le fichier `.env.local`:

```bash
# EmailJS Configuration
VITE_EMAILJS_SERVICE_ID=service_abc123      # Votre SERVICE ID
VITE_EMAILJS_TEMPLATE_ID=template_xyz789    # Votre TEMPLATE ID
VITE_EMAILJS_PUBLIC_KEY=aBc123XyZ           # Votre PUBLIC KEY

# Stripe Configuration (on va configurer √ßa apr√®s)
VITE_STRIPE_PUBLIC_KEY=pk_test_...
```

---

## üí≥ √âTAPE 2: CONFIGURATION STRIPE

### 2.1 Cr√©er un compte Stripe

1. Allez sur **https://stripe.com/**
2. Cliquez sur "Start now" et cr√©ez un compte
3. **IMPORTANT**: S√©lectionnez **Canada** comme pays
4. Remplissez les informations de votre entreprise:
   - Nom: JSR D√©neigement
   - Adresse: 303 rue des M√©l√®zes, Saint-Raymond, QC G3L 0E8
   - Type d'entreprise: Sole proprietorship / Travailleur autonome
   - Num√©ro d'entreprise (NEQ si vous en avez un)

### 2.2 Mode Test vs Production

Stripe a deux modes:
- **Test Mode** (cl√©s commencent par `pk_test_` et `sk_test_`) - Pour d√©veloppement
- **Live Mode** (cl√©s commencent par `pk_live_` et `sk_live_`) - Pour production

Commencez en Test Mode!

### 2.3 Obtenir les cl√©s API

1. Dans le dashboard Stripe, allez dans **"Developers"** > **"API keys"**
2. En mode **Test** (toggle en haut √† droite), notez:
   - **Publishable key** (commence par `pk_test_...`) - Pour le frontend
   - **Secret key** (commence par `sk_test_...`) - Pour le backend (NE PAS METTRE DANS LE SITE!)

3. Ajoutez la cl√© publique dans `.env.local`:

```bash
VITE_STRIPE_PUBLIC_KEY=pk_test_votre_cle_ici
```

### 2.4 **IMPORTANT - Backend requis pour Stripe!**

‚ö†Ô∏è **Le paiement Stripe n√©cessite un backend** pour des raisons de s√©curit√©.

Vous avez 3 options:

#### **Option A: Backend Node.js simple (RECOMMAND√â)**

Cr√©ez un petit serveur API:

```bash
# Dans le dossier du projet
mkdir backend
cd backend
npm init -y
npm install express stripe cors dotenv
```

Cr√©ez `backend/server.js`:

```javascript
const express = require('express');
const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);
const cors = require('cors');

const app = express();
app.use(cors());
app.use(express.json());

app.post('/api/create-checkout-session', async (req, res) => {
  const { amount, description, customerEmail } = req.body;

  try {
    const session = await stripe.checkout.sessions.create({
      payment_method_types: ['card'],
      line_items: [{
        price_data: {
          currency: 'cad',
          product_data: {
            name: description,
          },
          unit_amount: amount, // en cents
        },
        quantity: 1,
      }],
      mode: 'payment',
      customer_email: customerEmail,
      success_url: 'https://jsr.4lb.ca/paiement/success',
      cancel_url: 'https://jsr.4lb.ca/paiement/cancel',
    });

    res.json({ sessionId: session.id });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3001, () => console.log('Backend Stripe sur port 3001'));
```

#### **Option B: Cloudflare Workers (GRATUIT et d√©j√† dans votre stack!)**

Utilisez Cloudflare Workers (vous avez d√©j√† le compte):

```typescript
// worker.ts
export default {
  async fetch(request: Request): Promise<Response> {
    if (request.method === 'POST' && new URL(request.url).pathname === '/api/create-checkout-session') {
      const { amount, description, customerEmail } = await request.json();
      
      // Appel API Stripe ici
      // ...
    }
  }
}
```

#### **Option C: Paiements par liens Stripe (SOLUTION RAPIDE)**

Cr√©ez des liens de paiement directement dans Stripe:

1. Dashboard Stripe > **"Products"** > **"Create product"**
2. Cr√©ez des produits:
   - "Acompte JSR" - 50$
   - "D√©neigement Saison - Entr√©e Simple" - 500$
   - "D√©neigement Saison - Entr√©e Double" - 750$
3. Pour chaque produit, cr√©ez un **Payment Link**
4. Utilisez ces liens dans vos boutons

---

## üöÄ √âTAPE 3: TESTER LE FORMULAIRE

### 3.1 Compiler le projet

```bash
cd /home/lalpha/projets/developpement/JSR
npm run build
```

### 3.2 Reconstruire l'image Docker

```bash
docker build -t jsr2:local .
```

### 3.3 Red√©marrer le conteneur

```bash
docker stop jsr2-jsr2-1
docker rm jsr2-jsr2-1
docker run -d \
  --name jsr2-jsr2-1 \
  --restart unless-stopped \
  -p 8082:80 \
  jsr2:local
```

### 3.4 Tester

1. Allez sur **https://jsr.4lb.ca/contact**
2. Remplissez le formulaire
3. Cliquez sur "Envoyer"
4. V√©rifiez votre email (jsrdeneigement@gmail.com)

---

## üß™ TESTER STRIPE EN MODE TEST

Utilisez ces num√©ros de carte de test:

- **Succ√®s**: `4242 4242 4242 4242`
- **D√©clin√©**: `4000 0000 0000 0002`
- Date expiration: N'importe quelle date future
- CVC: N'importe quel 3 chiffres
- Code postal: N'importe quel code

---

## üìù PROCHAINES √âTAPES

1. ‚úÖ Configurez EmailJS (15 min)
2. ‚úÖ Testez le formulaire de contact
3. ‚è≥ Cr√©ez un compte Stripe
4. ‚è≥ D√©cidez de l'option backend (A, B ou C)
5. ‚è≥ Impl√©mentez les paiements

---

## üÜò BESOIN D'AIDE?

Si vous avez des questions ou probl√®mes:

1. V√©rifiez les logs du navigateur (F12 > Console)
2. V√©rifiez que les variables d'environnement sont bien d√©finies
3. Assurez-vous que le site est bien recompil√© apr√®s modification de `.env.local`

---

## üí° EXEMPLE D'UTILISATION DU BOUTON DE PAIEMENT

Une fois Stripe configur√©, vous pourrez utiliser:

```tsx
import { PaymentButton } from '@/components/PaymentButton';
import { PaymentType, SERVICE_PRICES } from '@/lib/stripe';

// Dans votre page
<PaymentButton
  amount={50}  // 50$ en dollars
  description="Acompte d√©neigement saison 2025-2026"
  type={PaymentType.DEPOSIT}
  customerEmail="client@example.com"
/>
```

---

**Cr√©√© le**: 21 octobre 2025  
**Derni√®re mise √† jour**: 21 octobre 2025
